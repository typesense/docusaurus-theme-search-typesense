---
name: Locale logging and i18n test
overview: اضافه کردن لاگ کنسول در تم جستجو برای خواندن و نمایش مقدار زبان جاری (و سایر مقادیر i18n) از context داکیوسورس، به‌همراه یک سناریو تست ساده برای اطمینان از دیده شدن مقدار درست قبل از وصل کردن مجدد به i18n.
todos: []
isProject: false
---

# پلن: لاگ زبان جاری از داکیوسورس و سناریو تست

## هدف

قبل از وصل کردن مجدد تم به ماژول i18n و پشتیبانی چندزبان، مطمئن شویم که **زبان جاری را در کامپوننت تم از داکیوسورس می‌خوانیم**. برای همین یک نسخه فقط با **لاگ کنسول** ساخته می‌شود که مقادیر i18n را از context داکیوسورس بخواند و در کنسول مرورگر چاپ کند؛ سپس یک سناریو تست برای تأیید مقدار درست تعریف می‌شود.

## ۱. مقادیری که در تم قابل خواندن هستند

تم در **مرورگر** اجرا می‌شود و به `useDocusaurusContext()` دسترسی دارد. این تابع شیء‌ای برمی‌گرداند که معمولاً شامل موارد زیر است:

- **`i18n.currentLocale`** — زبان فعلی (مثلاً `"fa"` یا `"en"`)
- **`i18n.locales`** — آرایهٔ زبان‌های تعریف‌شده در تنظیمات
- **`i18n.defaultLocale`** — زبان پیش‌فرض

تنظیمات `i18n` در `docusaurus.config` (مثل `defaultLocale: "fa"`, `locales: ["fa"]`) در زمان بیلد/سرور اعمال می‌شوند و در runtime همان‌طور که داکیوسورس به تم می‌دهد، در این فیلدها در دسترس هستند. ما فقط همان چیزی را که تم از context می‌گیرد لاگ می‌کنیم.

## ۲. محل اضافه کردن لاگ

به‌دلیل اینکه:

- **SearchBar** (کامپوننت دکمه و مودال جستجو) در هر صفحه لود می‌شود و از `useDocusaurusContext()` استفاده می‌کند،
- و بعداً ترجمه‌های مودال باید بر اساس همین locale انتخاب شوند،

لاگ در **کامپوننت DocSearch داخل SearchBar** اضافه شود تا هر بار که این بخش رندر می‌شود (یعنی کاربر در سایتی با زبان فعلی است)، یک بار در کنسول مقادیر i18n چاپ شوند و با تغییر زبان (در صورت وجود localeDropdown) دوباره لاگ به‌روز دیده شود.

فایل: [src/theme/SearchBar/index.tsx](e:\saberprojects-eeeee\kasra\docu sauros\docusaurus-theme-search-typesense\src\theme\SearchBar\index.tsx)

- در تابع `DocSearch` به‌جای فقط `const {siteMetadata} = useDocusaurusContext();` کل context (یا حداقل `siteConfig` و `i18n`) را بگیر.
- داخل یک `useEffect` با وابستگی به `currentLocale` (یا کل `i18n`) یک بار در کنسول لاگ بزن، مثلاً:
- `currentLocale`
- `locales`
- `defaultLocale`
- در صورت تمایل هر فیلد دیگری از `i18n` که در context هست (تا بعداً برای i18n از همان‌ها استفاده کنیم).

با این کار وقتی کاربر صفحه را باز کند یا زبان را عوض کند، در کنسول مرورگر دقیقاً می‌بینیم تم چه مقداری برای زبان جاری از داکیوسورس دریافت کرده است.

## ۳. سناریو تست (قبل از هر تغییر ترجمه)

1. **اجرای سایت** (مثلاً kasra-docs با `locales: ["fa"] `و `defaultLocale: "fa"`).
2. **باز کردن یک صفحه** که نوار جستجو (SearchBar) روی آن رندر می‌شود.
3. **باز کردن DevTools و تب Console**.
4. **بررسی لاگ:** باید یک لاگ با پیشوند مشخص (مثلاً `[docusaurus-theme-search-typesense]`) ببینید که مقدار `currentLocale` (و در صورت وجود `locales` و `defaultLocale`) را نشان می‌دهد؛ برای تنظیم فعلی انتظار می‌رود مثلاً `currentLocale: "fa"` باشد.
5. **(اختیاری)** اگر در config زبان دوم (مثلاً `en`) به `locales` اضافه شده و localeDropdown دارید، زبان را به انگلیسی تغییر دهید و دوباره همان صفحه/جستجو را باز کنید؛ لاگ باید این بار `currentLocale: "en"` (یا معادل) را نشان دهد.

اگر در هر دو حالت مقدار لاگ‌شده با زبان انتخاب‌شده در سایت یکی بود، سناریو تست passed است و می‌توان با اطمینان مرحلهٔ بعد (وصل کردن ترجمه‌های مودال و صفحهٔ جستجو به i18n بر اساس همین `currentLocale`) را انجام داد.

## ۴. پیاده‌سازی پیشنهادی (خلاصه)

- در [src/theme/SearchBar/index.tsx](e:\saberprojects-eeeee\kasra\docu sauros\docusaurus-theme-search-typesense\src\theme\SearchBar\index.tsx):
- در `DocSearch` از `useDocusaurusContext()` مقدار `i18n` را بگیر (و در صورت نیاز کل context).
- با `useEffect` و وابستگی به `i18n.currentLocale` (یا `i18n`) یک بار لاگ کنسول با پیشوند مشخص بنویس و مقادیر `currentLocale`, `locales`, `defaultLocale` را چاپ کن.
- هیچ تغییر دیگری در منطق ترجمه یا i18n در این مرحله لازم نیست؛ فقط لاگ برای اطمینان از «دیده شدن مقدار زبان در کامپوننت خودمان» است.

## ۵. مرحلهٔ بعد (خارج از این پلن)

بعد از تأیید سناریو تست و اطمینان از مقدار زبان در کنسول، در یک پلن جدا می‌توان:

- ترجمه‌های مودال و صفحهٔ جستجو را دوباره به i18n وصل کرد تا بر اساس `currentLocale` از فایل‌های `i18n/<locale>/theme.json` استفاده شود و همهٔ زبان‌های تعریف‌شده در داکیوسورس پشتیبانی شوند.